该文件为教材第一章的全排列生成算法的学习总结笔记。
主要知识点包括字典序法、递增进制数法、递减进制数法和邻位对换法生成全排列。
# 字典序法

## 字典序
两个字典序比较谁先谁后，是比较尽可能长的相同前缀下，后置数字的大小的。
后置数字是从右向左，遇到第一个下降值时停止。
比如65478321的后置数字为8321，86421357的后置数字为7
同时字典序的向下迭代，是通过置换前缀最后一个数字和后置数字中比其大的最小值，并将新的后置数字置为最小，然后将前缀相应的更新。

例如839647521的下一位是什么：
该数值的前缀是83964，因为从后向前数字$1\rightarrow2\rightarrow5\rightarrow7\rightarrow4$遇到了下降，也就是后置数字为$7521$，比前缀最后一位4大的最小值为5，将5与4进行置换，得到新的前缀83965和后置数字7421，然后将后置数字反转获得其对应最小值，下一位为 83965 1247

要求这一个与下一个有尽可能长的共同前 缀，也即变化限制在尽可能短的后缀上


**如何获取当前排序是字典序中的第几个值（序号从0开始）**

举例来讲，**839647521**是字典序中第几个排列?
其实是计算先于此排列的个数，其计算公式为  

$$\textcolor{red}{7}\times 8!+\textcolor{red}{2}\times7!+\textcolor{red}{6}\times6!+\textcolor{red}{4}\times5!+\textcolor{red}{2}\times4!+\textcolor{red}{3}\times3!+\textcolor{red}{2}\times2!+\textcolor{red}{1}\times1!$$

按照字典序的排序方法，我们得知，从前缀从长到短，每一个长度的前缀都有一系列的排列，我们将先于此排列的排列按照前缀进行分类。

- 前缀先于 8 的排列个数为：$7\times 8!$
	- $1********,2********,\cdots,7********$
	- 这是一个最短的前缀，比该前缀小的任何值，都会排在当前排列的前面
- 第一位是8，前缀先于 83 的排列个数为：$2\times 7!$
	- $81*******,82*******$
	- 也就是81和82开头的任何值，都比当前值小
- 前两位是83，先于839：$(8-2)\times 6!$
	- $831******,832******,834******,835******,836******,837******$
	- 因为8和3在前缀中，所有后置数字中不可能出现，所以是$8-2=6$
- 前三位是839，先于8396：$(5-1)\times 5!$
- 以此类推得到上式，最后一位为剩下的最后一个值。

## 中介数

将阶乘相加的式子前面的系数抽出，放在一起得到839647521的中介数为

$$72642321$$

中介数，序号和排列之间是一一对应的关系。

$$
[0,n!-1] == n!
$$
公式表示序号、序列数从0到$n!-1$和$n!$种排列一一对应。

中介数将序号和排列相连接。

==**中介数的特点：记录当前数字右边比当前数字小的数字的个数，可知中介数比排列中数字种类少一位（比如8位数字的排列，中介数应该最大为7位）。**==

该特点很容易通过上面的推理得到。

## 从中介数推出排列的方法

由 72642321 推算出 839647521

1. 7+1=8 推出第一位是8
2. 2+1=3 推出第二位是3
3. 6+1=7 但是比7小的3已经被使用，所以7+1=8，8也被使用了，8+1=9，所以第三位为9
4. 4+1=5 但是比5小的3已经出现，所以5+1=6，第四位为6
5. 2+1=3 但3已经使用，所以3+1=4
6. ...

起始中介数是一种递增进位制数$(a_9a_8a_7a_6a_5a_4a_3a_2)\uparrow$，为什么是以2为基数的递增进制数呢，因为最低位一定为1的阶乘，次低位为2的阶乘。对应以2为基数的递增进制数。
在十进制中，从右向左数的第$i$位增加1，说明数值增加了$10^{i-1}$。在以2为基数的递增进制数中，从右向左数的第$j$位加1（该位是$j+1$进制数），说明数值增加了$i!$。

## 序号推出中介数

那么根据上面的定义，递增进制数对应着十进制序号。递增进制数+1，对应着序号+1，这个容易理解。

将一个序号转换成其递增进位制数首先需要找到一个比序号小的最大阶乘数（即1、2、6、24、120、 720……），对其进行整数除得到递增进位制的第一位；将除法的余数反复应用这个方法（当然，之后选 择的余数是小一级的阶乘数），直到余数为0。
比如，序号100的递增进制数计算过程为：

1. 比100小的最大阶乘是$4!=24$，那么相当于100能用四位增进制数表示。
2. $mod(100,4!)=4,\lfloor{100/4!}\rfloor=4$
3. $mod(4,3!)=4,\lfloor{4/3!}\rfloor=0$
4. $mod(4,2!)=0,\lfloor{4/2!}\rfloor=2$
5. $mod(0,1!)=0,\lfloor{0/1!}\rfloor=0$
6. 那么增进制数为 4020

可以理解，序号减少$N$和中介数减去$N$对应的增进制值应该是相同的。


## 总结
排列值

$$
P_nP_{n-1}\cdots P_3P_2P_1
$$

字典序的中介数

$$(a_na_{n-1}\cdots a_3a_2)\uparrow$$

其中$a_i$是排列值中，$P_i$右侧比$P_i$小的数值的个数。该个数对应的反映了，当前缀为$P_nP_{n-1}\cdots P_{i}$时，有多少种长度相等的前缀排在该前缀前面。


# 递增进位制数法

## 新中介数的定义

在字典序法中由中介数求排列比较麻烦，我们可以通过另外定义递增进位制数加以改进。

$$
P_nP_{n-1}\cdots P_3P_2P_1 \  \Leftrightarrow \ (a_na_{n-1}\cdots a_2)\uparrow
$$

其中$a_i$是$P_j=i$的右边比$P_j$小的数字的个数。举例说明，839647521

- $a_2$ 表示数字2右侧比2小的数字的个数
	- 可以看到只有数字1，所以$a_2=1$
- $a_3$表示数字3右侧比3小的数字的个数
	- 可以看到右侧有2、1两个，所以$a_3=2$
- 数字4右侧有：2、1，所以$a_4=2$
- 数字5右侧有：2、1，所以$a_5=2$
- 数字6右侧有：4、5、2、1，所以$a_6=4$
- 数字7右侧有：5、2、1，所以$a_7=3$
- ...
- 最终新定义下的中介数为 $(67342221)\uparrow$

能够理解，该数和字典序的中介数是一一对应的，实际该递增进制数实现了一种新的排列顺序。
## 从中介数到排列

**从大到小求出$n,n-1,\cdots,2,1$的位置**

同样按例子来理解$(67342221)\uparrow$

1. 9右侧有6个空格，$\_,\_,9,\_,\_,\_,\_,\_,\_$
2. 8右侧有7个空格
	1. 因为9右侧只有6个空格，那么8一定在9的左侧
	2. 更新为：$8,\_,9,\_,\_,\_,\_,\_,\_$
3. 7右侧有3个空格
	1. 从右向左数空格得到
	2. 更新为：$8,\_,9,\_,\_,7,\_,\_,\_$
5. 6右侧有4个空格，更新为：$8,\_,9,6,\_,7,\_,\_,\_$
6. 5右侧有2个空格，更新为：$8,\_,9,6,\_,7,5,\_,\_$
7. 最终得到排列为：839647521

## 得到下一个排列（中介数和序列的转换）

839647521 对应的递增进制数排列法的中介数为 $(67342221)\uparrow$，对应的序号为该中介数转换为十进制数

$$
6\times8+7)\times7+3)\times6+4)\times5+2)\times4+ 2)\times3+2)\times2+1=279905
$$

中介数$+1$， $(67342221)\uparrow+1= (67342300)\uparrow$。新中介数对应的序号和排列数分别为

$$
6\times8+7)\times7+3)\times6+4)\times5+2)\times4+ 3)\times3+0)\times2+0=279906
$$
$$849617523$$

## 总结

中介数实际上是提供了序列和排列之间的一种哈希函数关系。


# 递减进位制数法

## 递减进位制数

递减进位制数$(a_2a_3a_4a_5a_6a_7a_8a_9)$，为：最低位逢9进1，次低位逢8进1……
在递增进位制数法中，中介数的最低位是逢2进1，进位频繁，这是一个缺点。 **把递增进位制数翻转,就得到递减进位制数。**

## 下一个序列

$$
839647521 \Leftrightarrow (12224376)\downarrow
$$

下一个排列，新的中介数为
$$
1+ (12224376)\downarrow = (12224377)\downarrow
$$
那么对应的排列求法为：

- 9的右边有7个数比9小，放第8个空位
	- $\_,9,\_,\_,\_,\_,\_,\_,\_$
- 8的右边有7个数比8小，放第8个空位
	- $8,9,\_,\_,\_,\_,\_,\_,\_$
- 7的右边有3个数比7小，放第4个空位
	- $8,9,\_,\_,\_,7,\_,\_,\_$
- 6的右边有4个数比6小，放第5个空位
	- $8,9,\_,6,\_,7,\_,\_,\_$
- 5的右边有2个数比5小，放第3个空位
	-  $8,9,\_,6,\_,7,5,\_,\_$
- 4的右边有2个数比4小，放第3个空位
	- $8,9,\_,6,4,7,5,\_,\_$
- 3的右边有2个数比3小，放第3个空位
	- $8,9,3,6,4,7,5,\_,\_$
- 2的右边有1个数比2小，放第2个空位
	- $8,9,3,6,4,7,5,2,\_$
- $8,9,3,6,4,7,5,2,1$

## 中介数转序号

公式为

$$
a_2* 3 + a_3) * 4 + \cdots + a_7) * 8 + a_8) * 9 + a_9 = Order
$$

例子
$$(12224376)\downarrow$$

求序号 

$$=1×3+2)×4+2)×5+2)×6+4)×7+3)×8+7)×9+6 =340989$$

## 总结

排列和递减进制数的获取，是排列的递增进制数反转；

但是序号只能计算得到，不能由其递增进制数反转得到。

# 邻位对换法

递减进位制数法启发我们，能不能设计一种算法，下一个排列总是上一个排列某相邻两位对换得到的。递减进位制数字的换位是单向的，从右向左，逐个换位，直到最左端。邻位对换法的换位是双向的，通过保存数字的“方向性”来快速得到下一个排列。

设定$b_2b_3b_4b_5b_6b_7b_8b_9$为我们要求的中介数。**$1,\ 2$的方向一定是向左，且$1$永远不可移动**。$b_2$就是从$2$开始,背向$2$的方向所有比$2$小的数字的个数。知道了$b_2$的值之后就可以依次推导出$b_3b_4……$直到$b_9$的值。

规则如下：对于每一个大于2的数字$i$
- 如果$i$为奇数，其方向性决定于$b_{i-1}$的奇偶性，奇向右、偶向左。 
- 如果$i$为偶数，其方向性决定于$b_{i-1}+ b_{i-2}$的奇偶性，同样是奇向右 、偶向左。 
- 当得到方向性后，$b_i$的值就是背向$i$的方向直到排列边界这个区间里比$i$小的数字的个数。如此就能得到邻位对换法的中介数。

## 排列获得中介数

$$\mathsf{P}=\vec{8}\vec{3}\vec{9}\vec{6}\vec{4}\vec{7}\vec{5}\vec{2}\vec{1}\to(\quad1\quad0\quad1\quad2\quad1\quad3\quad7\quad2\quad)\downarrow $$
$$(\quad1\quad0\quad1\quad2\quad1\quad3\quad7\quad2\quad)=\mathbf{b}_2\mathbf{b}_3\mathbf{b}_4\mathbf{b}_5\mathbf{b}_6\mathbf{b}_7\mathbf{b}_8\mathbf{b}_9$$
2的方向向左:
	背向2的方向中比2小的数字有1个，b2=1
3的方向由b2为奇可以断定向右，
	背向3的方向中比3小的数字有0个，b3=0
4的方向由b2+b3为奇可以断定向右，
	背向4的方向中比4小的数字有1个，b4=1
5的方向由b4为奇可以断定向右，
	背向5的方向中比5小的数字有2个，b5=2
6的方向由b4+b5为奇可以断定向右，
	背向6的方向中比6小的数字有1个，b6=1
7的方向由b6为奇可以断定向右，
	背向7的方向中比7小的数字有3个，b7=3
8的方向由b6+b7为偶可以断定向左，
	背向8的方向中比8小的数字有7个，b8=7
9的方向由b8为奇可以断定向右，
	背向9的方向中比9小的数字有2个，b9=2

## 中介数获得排列

已知 $(10121372)\downarrow$ 求排列。
9：b8=7奇->9向右b9=2向右第3个空，
8：b6+b7=1+3=4偶->8向左b8=7向左第8个空
7：b6=1奇->7向右，b7=3向右第4个空
6：b4+b5=1+2=3奇->6向右，b6=1，向右第2个空
5：b4=1奇->5向右，b5=2，向右第3个空
4：b2+b3=1奇->4向右，b4=1，向右第2个空
3：b2=1奇->3向右，b3=0，向右第1个空
2：b2=1，向左第2个空

